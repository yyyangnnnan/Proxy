#!name=DLNA投屏优化
#!desc=为DLNA投屏启用局域网、组播和协议直连规则，确保规则模式和TUN模式下正常工作。
#!author=Generated by Grok & Optimized

[General]
# 排除特定组播地址不走TUN（适用于启用TUN模式时）
tun-excluded-routes = 192.168.0.0/16, 224.0.0.0/4, 239.255.255.250/32
# 优化DNS，确保本地mDNS不被劫持
dns-server = system, 223.5.5.5, 119.29.29.29
# 强制组播流量直连（增强兼容性）
always-direct-multicast = true

[Rule]
# 1. 局域网直连规则（覆盖常见私有IP段）
IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
IP-CIDR,169.254.0.0/16,DIRECT,no-resolve  # APIPA地址段（自动私有IP）

# 2. 组播和广播地址直连（DLNA依赖）
IP-CIDR,224.0.0.0/4,DIRECT,no-resolve  # 组播地址段
IP-CIDR,239.0.0.0/8,DIRECT,no-resolve  # 常见本地组播段
IP-CIDR,239.255.255.250/32,DIRECT,no-resolve  # SSDP特定组播地址
IP-CIDR,255.255.255.255/32,DIRECT,no-resolve  # 广播地址

# 3. DLNA/UPnP和mDNS端口放行（局域网内）
AND,((IP-CIDR,192.168.0.0/16),(DEST-PORT,1900)),DIRECT,no-resolve  # SSDP/UPnP发现端口
AND,((IP-CIDR,192.168.0.0/16),(DEST-PORT,5353)),DIRECT,no-resolve  # mDNS/Bonjour端口
AND,((IP-CIDR,192.168.0.0/16),(DEST-PORT,49152-65535)),DIRECT,no-resolve  # 动态端口范围

# 4. 本地域名直连（支持mDNS和局域网解析）
DOMAIN-SUFFIX,local,DIRECT
DOMAIN-SUFFIX,lan,DIRECT
DOMAIN-SUFFIX,localhost,DIRECT  # 补充常见本地域名
